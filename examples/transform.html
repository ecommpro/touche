<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
  <meta name="description" content="Touché JS Demos.">
  <meta name="keywords" content="touche, js, javascript, touch, mouse, pointer, events, gestures">
  <meta name="author" content="Manel R. Doménech">
  <link rel="stylesheet" href="css/style.css" />

  <style>
#viewport {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  touch-action: none;
}

#box {
  position: absolute;
  background: radial-gradient(#fff, #5ba7ff);
  width: 50%;
  height: 50%;
  top: 25%;
  left: 25%;
}

.handle {
  /*background: #000;*/
  position: absolute;
  width: 0px;
  height: 0px;
}   
.handle.nw {
    left: 0;
    top: 0;
}   
.handle.ne {
    right: 0;
    top: 0;
}   
.handle.se {
    right: 0;
    bottom: 0;
}       
.handle.sw {
    left: 0;
    bottom: 0;
}           
  </style>
</head>
<body>

  <div id="viewport">
    <div id="box">
    </div>
  </div>

<script src="/dist/touche.js"></script>

<script>
var
  pan = touche.gestures.pan(),
  pinch = touche.gestures.pinch(),
  rotate = touche.gestures.rotate()
;

var el = document.getElementById('viewport');
var box = document.getElementById('box');


var
  scale = 1,
  rotation = 0,
  tx = 0,
  ty = 0,
  cx = 0,
  cy = 0
;

var bounds = box.getBoundingClientRect();

var adjustx = 0, adjusty = 0;

function refresh() {
  var vx = cx - bounds.left;
  var vy = cy - bounds.top;

  var transforms = [
    'translate(' + (vx) + 'px, ' + (vy) + 'px)',
    'rotate(' + rotation +'deg)',
    'translate(' + (-vx) + 'px, ' + (-vy) + 'px)',

    'translate(' + (vx) + 'px, ' + (vy) + 'px)',
    'scale(' + scale + ')',
    'translate(' + (-vx) + 'px, ' + (-vy) + 'px)',

    'translate(' + (tx) + 'px, ' + (ty) + 'px)'
  ];

  var transform = transforms.join(" ");
  var origin = (vx) + 'px ' + (vy) + 'px';
  
  box.style.transform = transform;
  box.style["transform-origin"] = '0 0';

  //console.log(origin)
}

touche(el)
  .addGesture(pan)
  .addGesture(pinch)
  .addGesture(rotate)
  .on('touche.input', function(input) {
    input.stopEvent();
  })
  .on('panmove', function(result, input, session, calculator) {
    tx = input.deltaX;
    ty = input.deltaY;
  })  
  .on('rotatemove', function(result, input, session, calculator) {
    rotation = input.rotation;
  })
  .on('pinchmove', function(result, input, session, calculator) {
    scale = input.scale;
  })
  .on('touche.recentered', function(v, input) {
    console.log(v)

    console.log(cx, cy, ' --- ', input.centerX, input.centerY);

    adjustx += v.x;
    adjusty += v.y;
  })
  .on('touche.post', function(input) {
    cx = input.centerX;
    cy = input.centerY;
    refresh();    
  })
  ;
 
</script>


</body>
</html>